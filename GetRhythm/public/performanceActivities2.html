<!DOCTYPE html>
<html lang="en">
<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<!-- Bootstrap CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	
	<!-- Tone.js CDN -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.26/Tone.js" integrity="sha512-+esjJ8NSEfoB5Sr8R7jTcYxCR1Bd6q9C+WQC0JA2UXVPT8Mlo/TJqqyp0qeeoxFzkAaa8t6tZCHLGmw3oNI2Qg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
		
	<title>Performance Activities</title>
	<style>
		@charset "UTF-8";
		
		@font-face {
		  font-family: notation;
		  src: url(Musisync-KVLZ.ttf);
		}
		
		#circle {
			height: 150px;
			width: 150px; 
		  	background-color: #FF5733;
		}
		
		.notation {
			font-family: notation;
			font-size: 80px;
		}
			
	</style>
</head>
<body>
	
	<h1 class="display-4 text-center">Performance Activity</h1>
	
	<!-- Rhythm Pattern Implementation -->

	 <div class="container">	
	 
	 <!-- Rhythm 1 On/Off Button --> 
		<div class="row p-3">
		
			<div class="d-grid col-1 mx-auto ">
				<button id= "rhythm1" role="switch" aria-checked="false" type="button" class="btn btn-primary"><span>Rhythm 1</span></button>	
			</div>
			<div class="d-grid col-1 mx-auto ">
				<button id= "rhythm2" role="switch" aria-checked="false" type="button" class="btn btn-primary"><span>Rhythm 2</span></button>	
			</div>
			<div class="d-grid col-1 mx-auto ">
				<button id= "rhythm3" role="switch" aria-checked="false" type="button" class="btn btn-primary"><span>Rhythm 3</span></button>	
			</div>
			<div class="d-grid col-1 mx-auto ">
				<button id= "rhythm4" role="switch" aria-checked="false" type="button" class="btn btn-primary"><span>Rhythm 4</span></button>	
			</div>
			<div class="d-grid col-1 mx-auto ">
				<button id= "rhythm5" role="switch" aria-checked="false" type="button" class="btn btn-primary"><span>Rhythm 5</span></button>	
			</div>
			<div class="d-grid col-1 mx-auto ">
				<button id= "rhythm6" role="switch" aria-checked="false" type="button" class="btn btn-primary"><span>Rhythm 6</span></button>	
			</div>
			<div class="d-grid col-1 mx-auto ">
				<button id= "rhythm7" role="switch" aria-checked="false" type="button" class="btn btn-primary"><span>Rhythm 7</span></button>	
			</div>
			
		</div>
	
		<div class="row p-5  d-flex align-items-center ">
			<div class="col-4 mx-auto note1 invisible"><p id="symbols" class="display-5 text-center "><span class="note1 invisible notation">q</span> <span class="note2 invisible notation">q</span></p></div>
			<div class="d-grid gap-2 col-4 rhythmRow1 invisible ">
			<div id="circle" class="mx-auto rounded-circle"></div>
			</div>
			<div class="col-4 mx-auto"><p id="syllables" class="display-5 text-center note1 invisible "><span class="note1 invisible">ta</span> <span class="note2 invisible">ta</span></p></div>
	
		</div>
	</div>
	
	<h1>Debugging: <span id="loopTimeSpan"></span></h1>
<!-- 	Javascript for Rhythms -->	
		<script>
		var ID = "123";
		var rhythmID = 1;
		
		// Listener on #rhythm1 button
	  	document.querySelector("#rhythm1").addEventListener("click", function() {  		
	  		document.querySelector("#symbols").innerHTML = "<span class='note1 invisible notation'>q</span> <span class='note2 invisible notation'>q</span><span class='note3 invisible notation'></span>";
	  		document.querySelector("#syllables").innerHTML = "<span class='note1 invisible'>ta</span> <span class='note2 invisible'>ta</span><span class='note3 invisible'></span>";
	  		part.clear();
  			part.add("0", "C2");
  			part.add("4n", "C2");
  			part.add("4n.", "C20");
	  		startTransport();	
	  	})
	
		// Listener on #rhythm2 button
	  	document.querySelector("#rhythm2").addEventListener("click", function() {  		
	  		document.querySelector("#symbols").innerHTML = "<span class='note1 invisible notation'>q</span> <span class='note2 invisible notation'>n</span><span class='note3 invisible notation'></span>";
	  		document.querySelector("#syllables").innerHTML = "<span class='note1 invisible'>ta</span> <span class='note2 invisible'>ti-ti</span><span class='note3 invisible'></span>";
	  		part.clear();
  			part.add("0", "C2");
  			part.add("4n", "C2");
  			part.add("4n.", "C2");
 	  		startTransport();

		})
		
		// Listener on #rhythm3 button
	  	document.querySelector("#rhythm3").addEventListener("click", function() { 
	  		document.querySelector("#symbols").innerHTML = "<span class='note1 invisible notation'>n</span> <span class='note2 invisible notation'></span><span class='note3 invisible notation'>q</span>";
	  		document.querySelector("#syllables").innerHTML = "<span class='note1 invisible'>ti-ti</span> <span class='note2 invisible'></span><span class='note3 invisible'>ta</span>";
			part.clear();
			part.add("0", "C2");
			part.add("8n", "C2");
			part.add("4n", "C2");
			part.add("4n.", "C20");
 	  		startTransport();
		})
		
		// Listener on #rhythm4 button
	  	document.querySelector("#rhythm4").addEventListener("click", function() {
	  		document.querySelector("#symbols").innerHTML = "<span class='note1 invisible notation'>n</span> <span class='note2 invisible notation'></span><span class='note3 invisible notation'>n</span>";
	  		document.querySelector("#syllables").innerHTML = "<span class='note1 invisible'>ti-ti</span> <span class='note2 invisible'></span><span class='note3 invisible'>ti-ti</span>";
	  		part.clear();
			part.add("0", "C2");
			part.add("8n", "C2");
			part.add("4n", "C2");
			part.add("4n.", "C2");
	  		startTransport();
		})
		
		// Listener on #rhythm5 button
	  	document.querySelector("#rhythm5").addEventListener("click", function() { 
	  		document.querySelector("#symbols").innerHTML = "<span class='note1 invisible notation'>h</span> <span class='note2 invisible notation'></span><span class='note3 invisible notation'></span>";
	  		document.querySelector("#syllables").innerHTML = "<span class='note1 invisible'>ta</span> <span class='note2 invisible'>- a</span><span class='note3 invisible'></span>";
	  		rhythmPattern = [["0", "C2"]];
	  		part.clear();
			part.add("0", "C2");
			part.add("4n", "C20");
			part.add("4n.", "C20");
	  		startTransport();
		})
		
		// Listener on #rhythm6 button
	  	document.querySelector("#rhythm6").addEventListener("click", function() { 
	  		document.querySelector("#symbols").innerHTML = "<span class='note1 invisible notation'>j</span> <span class='note2 invisible notation'></span><span class='note3 invisible notation'>e</span>";
	  		document.querySelector("#syllables").innerHTML = "<span class='note1 invisible'>ta</span><span class='note2 invisible'>-i</span> <span class='note3 invisible'>ti</span>";
	  		part.clear();
			part.add("0", "C2");
			part.add("4n", "C20");
			part.add("4n.", "C2");
	  		startTransport();
		})
		
		// Listener on #rhythm7 button
	  	document.querySelector("#rhythm7").addEventListener("click", function() { 
	  		document.querySelector("#symbols").innerHTML = "<span class='note1 invisible notation'>e</span> <span class='note2 invisible notation'>q</span><span class='note3 invisible notation'>e</span>";
	  		document.querySelector("#syllables").innerHTML = "<span class='note1 invisible'>syn</span> <span class='note2 invisible'> - co </span><span class='note3 invisible'> - pa </span>";
	  		part.clear();
			part.add("0", "C2");
			part.add("8n", "C2");
			part.add("4n.", "C2");
	  		startTransport();
		})
	
		// Create synth
		const synth = new Tone.MembraneSynth().toDestination();
		var tempo = 80;
		
	 	// Rhythm Pattern 1 Implementation
		var noteCounter = 1;	

	 	// Part describes sound pattern to be played and includes visual sync
		const part = new Tone.Part(function(time, pitch, velocity){
		synth.triggerAttackRelease(pitch, "8n", time); // play an 8th note at the pitch and time passed in
		const loopTime = (Tone.Time(part.loopEnd).toMilliseconds())-(600000/(tempo*6.5));
		
  	    document.getElementById("loopTimeSpan").innerHTML = loopTime;
	    
		// Callback to create animation in time with sound
				Tone.Draw.schedule(() => {
					const noteElement = document.getElementsByClassName("note"+noteCounter);
					const circle = document.getElementById("circle");
					
					// 1st Beat Animation
					for(var i = 0; i < noteElement.length; i++)
					{
						noteElement[i].classList.remove("invisible");
						noteElement[i].classList.add("visible");
					}
					
					if (noteCounter < part.length){
						noteCounter += 1;
					}
					else {
						noteCounter = 1;
						setTimeout(() => {
							for (var i = 1; i <= part.length; i++){
								const noteOff = document.getElementsByClassName("note"+i);
								for(var j = 0; j < noteOff.length; j++)
								{
									noteOff[j].classList.remove("visible");
									noteOff[j].classList.add("invisible");
								}
							}			
						},loopTime ); 
					}
					
					if (pitch=="C2"){
						// Circle Animation
						circle.classList.add("visible");
						circle.classList.remove("invisible");
						
						setTimeout(() => {
							circle.classList.add("invisible");
							circle.classList.remove("visible");
						}, 100);
					}
				}, time, noteCounter);
				

			
		}, [["0", "C2"], ["4n", "C2"]]); // pitch and time of rhythm pattern notes
		//set the pattern to loop every 2 beats
 		part.set({
			"loop" : true,
			"loopEnd" : "2n"
			
		}); 
		
		// HTML Sound On/Off Button
	 	let playing = false; // boolean to track whether playing or not. sound not playing when page loads
	  	
	 	
		
		function startTransport() {
	  		if (!playing) {			
	 			playing = true;
	  			Tone.Transport.bpm.value = tempo;
	 			Tone.start();
	  			part.start(("+0.1"));
	 			Tone.Transport.start(("+0.1"));

	  		
			} else {
				noteCounter = 1;
	  			playing = false;
	  			Tone.Transport.stop();
 			}
	 	}
	
	</script>
	
	<!-- End of Rhythm 1 Implementation -->
	
	<!-- Bootstrap JavaScript -->	
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
		
</body>
</html>