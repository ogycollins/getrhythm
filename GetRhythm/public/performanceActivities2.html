<!DOCTYPE html>
<html lang="en">
<head>
	<!-- Required meta tags -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<!-- Bootstrap CSS -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	
	<!-- Tone.js CDN -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.26/Tone.js" integrity="sha512-+esjJ8NSEfoB5Sr8R7jTcYxCR1Bd6q9C+WQC0JA2UXVPT8Mlo/TJqqyp0qeeoxFzkAaa8t6tZCHLGmw3oNI2Qg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	
	
	<link rel="stylesheet" href="myStyles.css">
	
	<title>Performance Activities</title>
	
</head>
<body>
	
	<h1 class="display-4 text-center">Performance Activity</h1>
	
	<!-- Rhythm Pattern 1 Implementation -->

	 <div class="container">	
	 
	 <!-- Rhythm 1 On/Off Button --> 
		<div class="row p-3">
			<div class="col-4"></div>
			<div class="d-grid gap-2 col-4 mx-auto ">
				<button id= "rhythm1" role="switch" aria-checked="false" type="button" class="btn btn-primary"><span>Rhythm 1</span></button>	
			</div>
			<div class="col-4"></div>
	
		</div>
	
		<div class="row p-5  d-flex align-items-center ">
			<div class="col-4 mx-auto note1 invisible"><p class="display-5 text-center "><span class="note1 invisible notation">q</span> <span class="note2 invisible notation">q</span></p></div>
			<div class="d-grid gap-2 col-4 rhythmRow1 invisible ">
			<div id="square1" class="mx-auto rounded-circle"></div>
			</div>
			<div class="col-4 mx-auto"><p class="display-5 text-center note1 invisible"><span class="note1 invisible">ta</span> <span class="note2 invisible">ta</span></p></div>
	
		</div>
	</div>
	
	<h1>Contents of loopTime: <span id="loopTimeSpan"></span></h1>
<!-- 	Javascript for Rhythm 1 -->	
		<script>
	
		// Create synth
		const synth = new Tone.MembraneSynth().toDestination();
		var tempo = 80;
		
	 	// Rhythm Patter 1 Implementation
		var noteCounter = 1;	
	 	// Part describes sound pattern to be played and includes visual sync
		const part1 = new Tone.Part(function(time, pitch){
		synth.triggerAttackRelease(pitch, "8n", time); // play an 8th note at the pitch and time passed in
		const loopTime = Tone.Time(part1.loopEnd).toMilliseconds()-(600000/(tempo*8));
	    document.getElementById("loopTimeSpan").innerHTML = loopTime;
	    
		// Callback to create animation in time with sound
				Tone.Draw.schedule(() => {
					const noteElement = document.getElementsByClassName("note"+noteCounter);
/* 					const beat2 = document.getElementsByClassName("beat2");
 */					const circle = document.getElementById("square1");
					
					// 1st Beat Animation
					for(var i = 0; i < noteElement.length; i++)
					{
						noteElement[i].classList.remove("invisible");
						noteElement[i].classList.add("visible");
					}
					
					if (noteCounter < part1.length){
						noteCounter += 1;
					}
					else {
						noteCounter = 1;
						
						
					    setTimeout(() => {
							for (var i = 1; i <= noteElement.length; i++){
								const noteOff = document.getElementsByClassName("note"+i);
								for(var j = 0; j < noteOff.length; j++)
								{
									noteOff[j].classList.remove("visible");
									noteOff[j].classList.add("invisible");
								}
							}			
						},loopTime ); 	
					}
					
					// Circle Animation
					circle.classList.add("visible");
					circle.classList.remove("invisible");
					
					setTimeout(() => {
						circle.classList.add("invisible");
						circle.classList.remove("visible");
					}, loopTime);
				}, time, noteCounter);
				

			
		}, [["0", "C2"], ["0:1", "C2"]]); // pitch and time of rhythm pattern notes
		//set the pattern to loop every 2 beats
 		part1.set({
			"loop" : true,
			"loopEnd" : "2n"
			
		}); 
		
		// HTML Sound On/Off Button
	 	let playing1 = false; // boolean to track whether playing or not. sound not playing when page loads
	  	
	 	// Listener on #rhythm1 button
	  	document.querySelector("#rhythm1").addEventListener("click", function() {  	
			
	  		
	  		if (!playing1) {
	  			part1.start(0);

	 			Tone.start();
	 			Tone.Transport.start(("+0.1"));
	  			playing1 = true;
	  			Tone.Transport.bpm.value = tempo;
	  		
			} else {
	  			Tone.Transport.stop();
	  			part1.stop();
	  			playing1 = false;
			}
		})
	</script>
	
	<!-- End of Rhythm 1 Implementation -->
	
	<!-- Bootstrap JavaScript -->	
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
		
</body>
</html>